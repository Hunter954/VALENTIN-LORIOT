{% extends "base.html" %}
{% block body %}
<header class="top-nav">
  <div class="top-nav-inner">
    <div class="brand">
      {% if settings and settings.brand_logo_path %}
        <img class="brand-logo" src="{{ settings.brand_logo_path }}" alt="{{ settings.site_title }}" />
      {% else %}
        <div class="brand-mark">VL</div>
      {% endif %}
    </div>
    <nav class="menu">
      <a href="{{ url_for('main.home') }}">Home</a>
      <a href="{{ url_for('main.portfolio') }}" class="active">Portfolio</a>
      <a href="{{ url_for('main.events') }}">Events</a>
      <a href="{{ url_for('main.clients') }}">Clients</a>
      <a href="{{ url_for('main.about') }}">About Us</a>
      <a href="{{ url_for('main.contact') }}">Contact</a>
    </nav>
    <div class="social">
      {% for s in socials %}
        <a href="{{ s.url }}" aria-label="{{ s.name }}" title="{{ s.name }}"><i class="{{ s.icon_class }}"></i></a>
      {% endfor %}
    </div>
  </div>
</header>

<section class="section works" style="padding-top:140px;">
  <div class="section-inner">
    <h1 class="section-title" style="text-align:center;">PORTFOLIO</h1>

    <h2 class="section-title" style="margin-top:60px;">VIDEOS</h2>
    <div class="works-grid">
      {% for v in videos[:6] %}
        <div class="works-item">
          <a href="#" class="media-popup-link" data-popup="1" data-type="video" data-src="{{ v.file_path }}"><video class="works-video" playsinline muted autoplay preload="metadata" loop>
            <source src="{{ v.file_path }}" type="video/mp4">
          </video></a>
          {% if v.title %}
            <div class="works-item-overlay">{{ v.title }}</div>
          {% endif %}
        </div>
      {% endfor %}
      {% if videos|length == 0 %}
        <div class="works-empty">Add videos in /admin → Works.</div>
      {% endif %}
    </div>
    <div style="display:flex;justify-content:center;margin-top:24px;">
      <a class="btn" href="{{ url_for('main.portfolio_videos') }}">SEE MORE</a>
    </div>

    <h2 class="section-title" style="margin-top:80px;">PHOTOGRAPHED</h2>
    <div class="instagram-grid" style="margin-top:20px;">
      {% for p in photos[:12] %}
        <a href="#" class="media-popup-link" data-popup="1" data-type="image" data-src="{{ p.file_path }}"><img class="ig-photo" src="{{ p.file_path }}" alt="Photo {{ loop.index }}" /></a>
      {% endfor %}
      {% if photos|length == 0 %}
        <div class="ig-empty">Add photos in /admin → Portfolio Photos.</div>
      {% endif %}
    </div>
    <div style="display:flex;justify-content:center;margin-top:24px;">
      <a class="btn" href="{{ url_for('main.portfolio_photos') }}">SEE MORE</a>
    </div>
  </div>
</section>
<!-- MEDIA POPUP (foto/vídeo) -->
<div id="mediaModal" class="media-modal" aria-hidden="true">
  <div class="media-modal__backdrop" data-close="1"></div>

  <div class="media-modal__content" role="dialog" aria-modal="true">
    <button class="media-modal__close" type="button" data-close="1" aria-label="Close">×</button>

    <img id="mediaModalImg" class="media-modal__img" alt="" style="display:none;">
    <video id="mediaModalVideo" class="media-modal__video" controls playsinline controlsList="nodownload noplaybackrate" disablepictureinpicture oncontextmenu="return false;" style="display:none;"></video>
  </div>
</div>

<style>
  .media-modal { position: fixed; inset: 0; display: none; z-index: 9999; }
  .media-modal.is-open { display: block; }
  .media-modal__backdrop { position: absolute; inset: 0; background: rgba(0,0,0,.75); }
  .media-modal__content {
    position: relative;
    width: min(1000px, calc(100% - 24px));
    margin: 60px auto;
    background: #0b0b0b;
    border: 1px solid rgba(255,255,255,.12);
    border-radius: 14px;
    padding: 12px;
    box-shadow: 0 20px 70px rgba(0,0,0,.6);
  }
  .media-modal__close {
    position: absolute; top: 8px; right: 10px;
    width: 36px; height: 36px;
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,.15);
    background: rgba(255,255,255,.06);
    color: #fff; font-size: 22px; cursor: pointer;
  }
  .media-modal__img { width: 100%; height: auto; border-radius: 10px; }
  .media-modal__video { width: 100%; max-height: 70vh; border-radius: 10px; }
  .works-item a.media-popup-link { display:block; color: inherit; text-decoration:none; }
  /* Hide any residual video UI on thumbnails */
  .works-video::-webkit-media-controls { display:none !important; }
  .works-video::-webkit-media-controls-enclosure { display:none !important; }
</style>

<script>
  (function () {
    const modal = document.getElementById("mediaModal");
    const img = document.getElementById("mediaModalImg");
    const video = document.getElementById("mediaModalVideo");

    // Prevent right-click download menu on the modal video (best-effort)
    video.addEventListener('contextmenu', (e) => e.preventDefault());

    function openModal({ type, src, poster }) {
      modal.classList.add("is-open");
      modal.setAttribute("aria-hidden", "false");
      document.documentElement.style.overflow = "hidden";

      img.style.display = "none";
      img.removeAttribute("src");
      video.style.display = "none";
      video.pause();
      video.removeAttribute("src");
      video.load();

      if (type === "image") {
        img.src = src;
        img.style.display = "block";
      } else {
        if (poster) video.setAttribute("poster", poster);
        video.src = src;
        video.style.display = "block";
        setTimeout(() => video.play().catch(() => {}), 50);
      }
    }

    function closeModal() {
      modal.classList.remove("is-open");
      modal.setAttribute("aria-hidden", "true");
      document.documentElement.style.overflow = "";

      video.pause();
      video.removeAttribute("src");
      video.load();
      img.removeAttribute("src");
    }

    modal.addEventListener("click", (e) => {
      if (e.target && e.target.dataset && e.target.dataset.close) closeModal();
    });

    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && modal.classList.contains("is-open")) closeModal();
    });

    document.addEventListener("click", (e) => {
      const el = e.target.closest("[data-popup]");
      if (!el) return;

      e.preventDefault();

      const type = el.getAttribute("data-type") || "image";
      const src = el.getAttribute("data-src");
      const poster = el.getAttribute("data-poster") || "";

      if (!src) return;
      openModal({ type, src, poster });
    });
  })();
</script>
{% endblock %}
