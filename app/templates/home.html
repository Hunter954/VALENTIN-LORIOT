{% extends "base.html" %}
{% block body %}

<style>
  /* ================= HERO FULLSCREEN ================= */
  .hero { position: relative; overflow: hidden; background:#000; }
  .hero-scroller { position: relative; width: 100%; height: 100%; }
  .hero-slide{
    position: relative;
    width: 100%;
    height: 100svh;   /* melhor no mobile (barra do navegador) */
    overflow: hidden;
    background:#000;
  }

  /* Vídeo local */
  .hero-video{
    position:absolute; inset:0;
    width:100%; height:100%;
    object-fit:cover;
  }

  /* Vimeo/YT iframe (geral) */
  .hero-embed{
    position:absolute;
    top:50%; left:50%;
    width:100vw;
    height:56.25vw;         /* 16:9 baseado em vw */
    min-width:177.78svh;    /* 16:9 baseado em svh */
    min-height:100svh;
    transform:translate(-50%,-50%);
    border:0;
    pointer-events:none;     /* não deixa clicar/abrir UI */
    background:#000;
  }

  /* MOBILE PORTRAIT: enche a tela (crop/zoom) */
  @media (max-width: 900px) and (orientation: portrait){
    .hero-slide{ height:100svh; }

    /* Faz cover agressivo no portrait (pra parecer 9:16 preenchido) */
    .hero-embed{
      width:120vw;
      height:120svh;
      min-width:120vw;
      min-height:120svh;
      transform:translate(-50%,-50%) scale(1.12);
    }
  }

  /* ================= Overlay ================= */
  .hero-overlay{ position:absolute; inset:0; display:flex; align-items:center; justify-content:center; }
  .hero-overlay-inner{ text-align:center; }

  /* ================= WORKS ================= */
  .works-item{ position:relative; overflow:hidden; }
  .works-video{ width:100%; height:100%; object-fit:cover; }
  .works-embed{
    position:absolute; inset:0;
    width:100%; height:100%;
    border:0;
    pointer-events:none;
  }

  /* ================= SHOWREEL ================= */
  .showreel-inner{ position:relative; overflow:hidden; }
  .showreel-video{
    position:absolute; inset:0;
    width:100%; height:100%;
    object-fit:cover;
  }
  .showreel-embed{
    position:absolute;
    top:50%; left:50%;
    width:100vw;
    height:56.25vw;
    min-width:177.78svh;
    min-height:100%;
    transform:translate(-50%,-50%);
    border:0;
    pointer-events:none;
    background:#000;
  }
  @media (max-width: 900px) and (orientation: portrait){
    .showreel-embed{
      width:120vw;
      height:120svh;
      min-width:120vw;
      min-height:100%;
      transform:translate(-50%,-50%) scale(1.12);
    }
  }
</style>

<header class="top-nav">
  <div class="top-nav-inner">
    <div class="brand">
      {% if settings and settings.brand_logo_path %}
        <img class="brand-logo" src="{{ settings.brand_logo_path }}" alt="{{ settings.site_title }}" />
      {% else %}
        <div class="brand-mark">VL</div>
      {% endif %}
    </div>

    <nav class="menu">
      <a href="{{ url_for('main.home') }}#home">Home</a>
      <a href="{{ url_for('main.portfolio') }}">Portfolio</a>
      <a href="{{ url_for('main.events') }}">Events</a>
      <a href="{{ url_for('main.clients') }}">Clients</a>
      <a href="{{ url_for('main.about') }}">About Us</a>
      <a href="{{ url_for('main.contact') }}">Contact</a>
    </nav>

    <div class="social">
      {% if socials and socials|length > 0 %}
        {% for s in socials %}
          <a href="{{ s.url }}" aria-label="{{ s.name }}" title="{{ s.name }}">
            <i class="{{ s.icon_class }}"></i>
          </a>
        {% endfor %}
      {% else %}
        <a href="{{ settings.instagram_url if settings else '#' }}" aria-label="Instagram" title="Instagram"><i class="fa-brands fa-instagram"></i></a>
        <a href="#" aria-label="Vimeo" title="Vimeo"><i class="fa-brands fa-vimeo"></i></a>
        <a href="#" aria-label="WhatsApp" title="WhatsApp"><i class="fa-brands fa-whatsapp"></i></a>
      {% endif %}
    </div>
  </div>
</header>

<section id="home" class="hero">
  <div class="hero-scroller" id="heroScroller" aria-label="Hero videos">
    {% if hero_videos|length == 0 %}
      <div class="hero-slide">
        <div class="hero-fallback">
          <p>Add 3 videos in <strong>/admin</strong> → Hero Videos.</p>
        </div>
      </div>
    {% else %}
      {% for v in hero_videos %}
        {% set path = (v.file_path or '') %}
        {% set is_vimeo = ('vimeo.com' in path) or ('player.vimeo.com' in path) %}

        <div class="hero-slide" data-index="{{ loop.index0 }}">
          {% if is_vimeo %}
            <!-- src será montado via JS para garantir background=1 (sem UI no mobile) -->
            <iframe
              class="hero-embed vimeo-bg"
              data-src="{{ path }}"
              src=""
              allow="autoplay; fullscreen; picture-in-picture"
              allowfullscreen
              title="Vimeo background video">
            </iframe>
          {% else %}
            <video class="hero-video" playsinline muted preload="metadata" loop>
              <source src="{{ path }}" type="video/mp4">
            </video>
          {% endif %}

          <div class="hero-overlay">
            <div class="hero-overlay-inner">
              {% if v.overlay_top %}
                <div class="hero-overlay-top">{{ v.overlay_top }}</div>
              {% endif %}
              <div class="hero-overlay-title">
                {{ v.overlay_title if v.overlay_title else (settings.hero_tagline if settings else 'driving profit') }}
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    {% endif %}
  </div>

  <div class="hero-progress" aria-hidden="true">
    {% for i in range(1, (hero_videos|length if hero_videos|length else 3) + 1) %}
      <div class="hero-dot">{{ i }}</div>
    {% endfor %}
  </div>

  <div class="hero-fade-bottom"></div>
</section>

<section id="about" class="section about section-overlay">
  <div class="section-inner">
    <h2 class="section-title">{{ settings.about_title if settings else "VALENTIN LORIOT" }}</h2>
    <div class="about-text">
      {{ (settings.about_text if settings else "") | replace('\n','<br/>') | safe }}
    </div>
  </div>
</section>

<section id="showreel" class="section showreel">
  <div class="showreel-inner">
    {% if showreel %}
      {% set spath = (showreel.file_path or '') %}
      {% set showreel_is_vimeo = ('vimeo.com' in spath) or ('player.vimeo.com' in spath) %}

      {% if showreel_is_vimeo %}
        <iframe
          class="showreel-embed vimeo-bg"
          data-src="{{ spath }}"
          src=""
          allow="autoplay; fullscreen; picture-in-picture"
          allowfullscreen
          title="Showreel vimeo background">
        </iframe>
      {% else %}
        <video class="showreel-video" playsinline muted preload="metadata" loop>
          <source src="{{ spath }}" type="video/mp4">
        </video>
      {% endif %}

      <div class="showreel-overlay">
        <h3 class="showreel-title">{{ showreel.title }}</h3>
        <p class="showreel-sub">Showreel vibes</p>
      </div>
    {% else %}
      <div class="showreel-empty">
        <h3>Showreel vibes</h3>
        <p>Add a showreel in <strong>/admin</strong> → Showreel.</p>
      </div>
    {% endif %}
  </div>
</section>

<section id="clients" style="padding:100px 0;">
  <h2 style="text-align:center;margin-bottom:60px;">CLIENTS</h2>

  <div style="
    max-width:1200px;
    margin:0 auto;
    padding:0 40px;
    display:flex;
    flex-wrap:wrap;
    justify-content:center;
    align-items:center;
    gap:80px;
  ">
    {% for client in client_logos %}
      <img src="{{ client.file_path }}"
           style="height:60px; width:auto; max-width:240px; object-fit:contain;">
    {% endfor %}
  </div>
</section>

<section id="works" class="section works">
  <div class="section-inner">
    <h2 class="section-title">PORTFOLIO</h2>

    <div class="works-grid">
      {% for g in works_videos[:6] %}
        {% set wpath = (g.file_path or '') %}
        {% set works_is_vimeo = ('vimeo.com' in wpath) or ('player.vimeo.com' in wpath) %}

        <div class="works-item">
          {% if works_is_vimeo %}
            <iframe
              class="works-embed vimeo-bg"
              data-src="{{ wpath }}"
              src=""
              allow="autoplay; fullscreen; picture-in-picture"
              allowfullscreen
              title="Works vimeo background">
            </iframe>
          {% else %}
            <video class="works-video" playsinline muted preload="metadata" loop>
              <source src="{{ wpath }}" type="video/mp4">
            </video>
          {% endif %}

          {% if g.title %}
            <div class="works-item-overlay">{{ g.title }}</div>
          {% endif %}
        </div>
      {% endfor %}

      {% if works_videos|length == 0 %}
        <div class="works-empty">Add videos in /admin → Works (Videos).</div>
      {% endif %}
    </div>

    <div style="display:flex;justify-content:center;margin-top:30px;">
      <a class="btn" href="{{ url_for('main.portfolio') }}">SEE MORE</a>
    </div>
  </div>
</section>

<section class="section instagram">
  <div class="instagram-wrap">
    <div class="instagram-grid">
      {% for p in ig_photos %}
        <img class="ig-photo" src="{{ p.file_path }}" alt="Instagram photo {{ loop.index }}" />
      {% endfor %}
      {% if ig_photos|length == 0 %}
        <div class="ig-empty">Add photos in /admin → Instagram Photos.</div>
      {% endif %}
    </div>

    <a class="follow-ig"
       href="{{ socials[0].url if (socials and socials|length>0) else (settings.instagram_url if settings else '#') }}"
       target="_blank" rel="noopener">
      FOLLOW US ON INSTAGRAM
    </a>
  </div>
</section>

<footer class="footer">
  <div class="footer-inner">
    <div class="footer-brand">
      <div class="brand">
        {% if settings and settings.brand_logo_path %}
          <img class="brand-logo" src="{{ settings.brand_logo_path }}" alt="{{ settings.site_title }}" />
        {% else %}
          <div class="brand-mark">VL</div>
        {% endif %}
      </div>
      <div class="footer-social">
        {% if socials and socials|length > 0 %}
          {% for s in socials %}
            <a href="{{ s.url }}" aria-label="{{ s.name }}" title="{{ s.name }}"><i class="{{ s.icon_class }}"></i></a>
          {% endfor %}
        {% else %}
          <a href="{{ settings.instagram_url if settings else '#' }}"><i class="fa-brands fa-instagram"></i></a>
          <a href="#"><i class="fa-brands fa-vimeo"></i></a>
          <a href="#"><i class="fa-brands fa-whatsapp"></i></a>
        {% endif %}
      </div>
    </div>

    <div class="footer-col">
      <h4>ABOUT</h4>
      <p>{{ (settings.footer_about if settings and settings.footer_about else 'A visual storytelling studio dedicated to capturing emotion, atmosphere, and timeless narratives.') }}</p>
    </div>

    <div class="footer-col">
      <h4>CONTACTS</h4>
      <p>
        {% if settings and settings.footer_phone %}Phone: {{ settings.footer_phone }}<br>{% endif %}
        {% if settings and settings.footer_email %}Email: {{ settings.footer_email }}{% endif %}
        {% if (not settings or (not settings.footer_phone and not settings.footer_email)) %}
          Phone: +55 (87) 654 321 0<br>
          Email: support@valentinloriot.fr
        {% endif %}
      </p>
      <p class="copyright">
        {% if settings and settings.footer_copyright %}
          {{ settings.footer_copyright }}
        {% else %}
          © {{ 2026 }} {{ settings.site_title if settings else "Portfolio" }}. All rights reserved.
        {% endif %}
      </p>
    </div>
  </div>
</footer>

<script>
  // Converte QUALQUER URL do Vimeo em "background embed" (sem UI) e seta no iframe
  (function () {
    function buildVimeoBackgroundUrl(raw) {
      if (!raw) return "";

      // já é player.vimeo.com/video/ID...
      let id = null;

      // pega o primeiro número longo do link (id do Vimeo)
      const m = String(raw).match(/vimeo\.com\/(?:video\/)?(\d+)/i);
      if (m && m[1]) id = m[1];

      // fallback: se já veio com /video/123...
      if (!id) {
        const m2 = String(raw).match(/player\.vimeo\.com\/video\/(\d+)/i);
        if (m2 && m2[1]) id = m2[1];
      }

      if (!id) return raw; // se não conseguir extrair, deixa como veio

      const params = new URLSearchParams({
        background: "1",
        autoplay: "1",
        loop: "1",
        muted: "1",
        autopause: "0",
        title: "0",
        byline: "0",
        portrait: "0",
        dnt: "1"
      });

      return "https://player.vimeo.com/video/" + id + "?" + params.toString();
    }

    document.querySelectorAll("iframe.vimeo-bg").forEach(function (iframe) {
      const raw = iframe.getAttribute("data-src") || "";
      const url = buildVimeoBackgroundUrl(raw);
      iframe.setAttribute("src", url);
    });
  })();
</script>

{% endblock %}
