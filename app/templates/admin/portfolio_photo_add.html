{% extends "admin/base.html" %}

{% block body %}
<div class="container-fluid" style="max-width: 980px;">
  <div class="d-flex align-items-center justify-content-between mb-3">
    <div>
      <h2 class="mb-0">Portfolio Photos</h2>
      <div class="text-muted small">Adicionar uma nova foto ao Photographed</div>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <form method="POST" enctype="multipart/form-data">
        {{ form.hidden_tag() }}

        <div class="row g-3">
          <div class="col-12">
            <label class="form-label">Title</label>
            {{ form.title(class_="form-control", placeholder="Ex: Driving Profit") }}
          </div>

          <div class="col-12 col-md-4">
            <label class="form-label">Order</label>
            {{ form.position(class_="form-control") }}
            <div class="form-text">Menor número aparece primeiro.</div>
          </div>

          <div class="col-12">
            <label class="form-label">Image</label>
            {{ form.image(class_="form-control") }}
            <div class="form-text">Upload ou cole uma URL abaixo (imagem pública).</div>
          </div>

          <div class="col-12">
            <label class="form-label">Image URL</label>
            {{ form.image_url(class_="form-control", placeholder="https://...") }}
            <div class="form-text">Se preencher a URL, pode deixar o upload vazio.</div>
          </div>

          <div class="col-12 d-flex gap-2">
            <button type="submit" class="btn btn-accent">Upload</button>
            <a href="{{ url_for('admin.dashboard') }}" class="btn btn-ghost">Cancelar</a>
          </div>
        </div>
      </form>
    </div>
  </div>

  <div class="card mt-3">
    <div class="card-body">
      <div class="d-flex align-items-center justify-content-between">
        <h5 class="mb-0">Fotos cadastradas</h5>
        <div class="text-muted small">(preview + excluir)</div>
      </div>
      <hr>

      {% if portfolio_photos is defined and portfolio_photos %}
        <div class="list-group">
          {% for p in portfolio_photos %}
            {% set src = p.file_path %}
            {% if src and (not src.startswith('http')) and (not src.startswith('/')) %}
              {% set src = url_for('static', filename=src) %}
            {% endif %}

            <div class="list-group-item d-flex justify-content-between align-items-start gap-3">
              <div class="d-flex gap-3" style="min-width:0;">
                <div style="width: 180px;">
                  <img src="{{ src }}" alt="" style="width:100%; border-radius:10px; object-fit:cover;" />
                </div>
                <div style="min-width:0;">
                  <div><strong>#{{ p.position }}</strong> — {{ p.title }}</div>
                  <div class="text-muted small text-truncate" style="max-width: 520px;">{{ p.file_path }}</div>
                  <a class="btn btn-sm btn-ghost mt-2" href="{{ src }}" target="_blank">Abrir arquivo</a>
                </div>
              </div>

              {% if p.id is defined %}
              <form method="post" action="{{ url_for('admin.portfolio_photos_delete', item_id=p.id) }}">
                <button class="btn btn-sm btn-outline-danger" onclick="return confirm('Remover este item?')">Excluir</button>
              </form>
              {% endif %}
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p class="text-muted mb-0">Nenhuma foto cadastrada ainda.</p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
